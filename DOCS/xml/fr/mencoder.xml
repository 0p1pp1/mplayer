<?xml version="1.0" encoding="iso-8859-1"?>
<!-- synced with 1.17 -->
<chapter id="mencoder">
<title>Encodage avec MEncoder</title>

<para>
Pour avoir la liste complète des options disponibles de <application>MEncoder</application>
et des exemples, voir la page de man. Pour une série d'exemples pratiques et de guides
détaillés sur l'utilisation des nombreux paramètres d'encodage, lisez les
<ulink url="../../tech/encoding-tips.txt">encoding-tips</ulink> (en anglais) qui ont
été collectés sur de nombreuses threads de la liste de diffusion
<ulink url="http://mplayerhq.hu/mailman/listinfo/mplayer-users">mplayer-users</ulink>.
Cherchez dans les
<ulink url="http://mplayerhq.hu/pipermail/mplayer-users/">archives</ulink> pour trouver
les discussions à propos de tous les aspects et problèmes relatif à l'encodage avec
<application>MEncoder</application>.
</para>

<sect1 id="menc-feat-divx4">
<title>Encodage MPEG-4 (&quot;DivX&quot;) 2 ou 3-passes</title>

<formalpara>
<title>Encodage 2-passes</title>
<para>
le nom vient du fait que cette méthode encode le fichier <emphasis>deux fois</emphasis>.
Le premier encodage (passe doublée) créé quelques fichiers temporaires (<filename>*.log</filename>)
avec une taille de quelques méga-octets, ne les détruisez pas tout de suite (vous pouvez
effacer l'AVI). Dans la seconde passe, la fichier de sortie 2-passes est créé, en
utilisant les données bitrate des fichiers temporaires. Le fichier résultant aura une
image de bien meilleur qualité. Si c'est la première fois que vous entendez parler de
ça, vous devriez consulter les guides disponibles sur le Net.
</para>
</formalpara>

<para>
Cet exemple montre comment encoder un DVD en AVI MPEG-4 (&quot;DIVX&quot;) AVI 2-passes.
Seules deux commandes sont requises:
<screen>rm frameno.avi</screen>
enlevez ce fichier, qui peut provenir d'un encodage 3-passes précédent (il interfère avec l'actuel)
<screen>
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 -oac copy -o <replaceable>film.avi</replaceable>
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=2 -oac copy -o <replaceable>film.avi</replaceable>
</screen>
</para>

<formalpara>
<title>Encodage 3-passes</title>
<para>
c'est une extension de l'encodage 2-passes, où l'encodage audio prends place dans une
passe séparée. Cette méthode permet l'estimation du bitrate vidéo recommandé de façon
à tenir sur un CD. De plus, l'audio n'est encodé qu'une fois, au contraire du mode
2-passes. Le principe:
</para>
</formalpara>

<procedure>
<step><para>
Supprimez les fichiers temporaires conflictuels:
  <screen>rm frameno.avi</screen>
  </para></step>
<step><para>
  <emphasis>Première passe:</emphasis>

  <screen>mencoder <replaceable>fichier/DVD</replaceable> -ovc frameno -oac mp3lame -lameopts vbr=3 -o frameno.avi</screen>

  Un fichier avi audio sera créé, contenant
  <emphasis role="bold">uniquement</emphasis> le flux audio demandé. N'oubliez pas
  <option>-lameopts</option>, si vous en avez besoin. Si vous encodez un long film,
  <application>MEncoder</application> affiche le bitrate recommandé pour les tailles
  650Mo, 700Mo, et 800Mo, après la fin de cette passe.
  </para></step>
<step><para>
  <emphasis>Seconde passe:</emphasis>
  <screen>
mencoder <replaceable>fichier/DVD</replaceable> -oac copy -ovc lavc -lavcopts vcodec=mpeg4:vpass=1:vbitrate=<replaceable>bitrate</replaceable><!--
--></screen>
Ceci est la première passe de l'encodage vidéo. Éventuellement spécifiez le bitrate
vidéo que MEncoder a affiché à la fin de la passe précédente.
  </para></step>
<step><para>
  <emphasis>Troisième passe:</emphasis>
<screen>
mencoder <replaceable>fichier/DVD</replaceable> -oac copy -ovc lavc -lavcopts vcodec=mpeg4:vpass=2:vbitrate=<replaceable>bitrate</replaceable>
</screen>
Ceci est la seconde passe de l'encodage vidéo. Spécifiez le même bitrate vidéo que
celui de la passe précédente à moins que vous ne sachiez réellement ce que vous faites.
Dans cette passe, l'audio de <filename>frameno.avi</filename> sera inséré dans le
fichier de destination... et tout est prêt!
</para></step>
</procedure>

<example>
<title>Exemple d'encodage 3-passes</title>
<para>
<screen>rm frameno.avi</screen>
enlevez ce fichier, qui peut provenir d'un encodage 3-passes précédent (il interfère
avec l'actuel)
<screen>
mencoder dvd://2 -ovc frameno -o frameno.avi -oac mp3lame -lameopts vbr=3
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 -oac copy -o <replaceable>film.avi</replaceable>
mencoder dvd://2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=2 -oac copy -o <replaceable>film.avi</replaceable>
</screen>
</para>
</example>
</sect1>

<sect1 id="menc-feat-mpeg">
<title>Encodage au format MPEG</title>
<para>
<application>MEncoder</application> peut créer des fichier au format MPEG (MPEG-PS).
Ceci n'est probablement utile qu'avec le codec <emphasis>mpeg1video</emphasis>
de <systemitem class="library">libavcodec</systemitem>, car les lecteurs - excepté <application>MPlayer</application>
- attendent de la vidéo MPEG1, et de l'audio MPEG1 layer 2 (MP2) dans les fichiers MPEG.
</para>

<para>
Cette fonction n'est pas vraiment utile actuellement, car elle a probablement de
nombreux bogues, mais plus important encore parce qu'actuellement MEncoder ne peut pas
encoder l'audio MPEG1 layer 2 (MP2), qui est attendu par tous les autres lecteurs dans
les fichiers MPEG.
</para>

<para>
Pour changer le format de sortie de MEncoder, utilisez l'option <option>-of mpeg</option>.
</para>

<para>
Exemple:
<screen>
mencoder -of mpeg -ovc lavc -lavcopts vcodec=mpeg1video -oac copy <replaceable>autres options</replaceable>
<replaceable>media.avi</replaceable> -o <replaceable>sortie.mpg</replaceable>
</screen>
</para>
</sect1>


<sect1 id="menc-feat-rescale">
<title>Redimensionnement des films</title>

<para>
Souvent le besoin de redimensionner les images d'un film se fait sentir. Les raisons
peuvent être multiples: diminuer la taille du fichier, la bande passante du réseau, etc.
La plupart des gens redimensionnement même en convertissant des DVDs ou SVCDs en AVI
DivX. C'est <emphasis role="bold">mal</emphasis>. Plutôt que de faire ça, lisez la
section <link linkend="aspect">Préserver l'aspect ratio</link>.
</para>

<para>
Le processus de zoom est géré par le filtre vidéo <literal>scale</literal> :
<option>-vf scale=<replaceable>largeur</replaceable>:<replaceable>hauteur</replaceable></option>.
Sa qualité peut être réglée avec l'option <option>-sws</option>.
Si elle n'est pas spécifiée, <application>MEncoder</application> utilisera 0: fast bilinear.
</para>

<para>
Utilisation:
<screen>
mencoder <replaceable>entree.mpg</replaceable> -ovc lavc -lavcopts vcodec=mpeg4 -vf scale=640:480 -o <replaceable>sortie.avi</replaceable>
</screen>
</para>
</sect1>


<sect1 id="menc-feat-streamcopy">
<title>Copie de flux</title>

<para>
<application>MEncoder</application> peut gérer les flux entrant de deux façons: les
<emphasis role="bold">encoder</emphasis> ou les <emphasis role="bold">copier</emphasis>
Cette section parle de la <emphasis role="bold">copie</emphasis>.
</para>

<itemizedlist>
<listitem><para>
  <emphasis role="bold">Flux vidéo</emphasis> (option <option>-ovc copy</option>):
  on peut faire des choses sympa :) comme, placer (pas convertir) de la vidéo FLI
  ou VIVO ou MPEG1 dans un fichier AVI ! Bien sûr seul <application>MPlayer</application>
  peut lire de tels fichiers :) et ça n'a probablement pas de valeur réelle du tout.
  Concrètement: copier des flux vidéo peut être utile par exemple quand seul le flux
  audio doit être encodé (comme du PCM non-compressé en MP3).
  </para></listitem>
<listitem><para>
  <emphasis role="bold">Flux audio</emphasis> (option <option>-oac copy</option>):
  très simple. Il est possible de prendre un fichier audio externe (MP3, Vorbis) et
  de le muxer dans le flux sortant. Utilisez l'option
  <option>-audiofile <replaceable>nomfichier</replaceable></option> pour cela.
  </para></listitem>
</itemizedlist>
</sect1>


<sect1 id="menc-feat-fix-avi">
<title>Réparer les fichiers AVIs ayant un index défectueux</title>

<para>
Facile. Nous copions simplement les flux vidéo et audio, et <application>MEncoder</application>
génère l'index. Bien sûr cela ne peut pas réparer les bogues possibles dans les flux
vidéo et/ou audio. Il répare également les fichiers avec un entrelacement endommagé,
ainsi l'option <option>-ni</option> ne sera plus requise.
</para>

<para>
Command:
<screen>
mencoder -idx <replaceable>entree.avi</replaceable> -ovc copy -oac copy -o <replaceable>sortie.avi</replaceable><!--
--></screen>
</para>


<sect2 id="menc-feat-appending">
<title>Assembler plusieurs fichiers AVI</title>

<para>
Un effet secondaire de la fonction de réparation d'AVI permet à MEncoder d'assembler 2
(ou plus) fichiers AVI:
</para>

<para>
Commande:
<screen>cat 1.avi 2.avi | mencoder -noidx -ovc copy -oac copy -o <replaceable>sortie.avi</replaceable> -</screen>
</para>

<note><para>
Cela suppose que <filename>1.avi</filename> et <filename>2.avi</filename> utilisent les
mêmes codecs, résolution, débit, etc. et qu'au moins <filename>1.avi</filename>
ne soit pas endommagé. Vous pouvez avoir besoin de réparer vos fichiers AVI d'entrée
d'abord, comme décrit <link linkend="menc-feat-fix-avi">çi-dessus</link>.
</para></note>
</sect2>
</sect1>

<sect1 id="menc-feat-enc-libavcodec">
<title>Encodage avec la famille de codecs <systemitem class="library">libavcodec</systemitem></title>

<para>
<link linkend="ffmpeg"><systemitem class="library">libavcodec</systemitem></link> permet un encodage simple dans de nombreux formats audio et vidéo intéressants. 
Vous pouvez encoder avec les codecs suivants (plus ou moins à jour):

<informaltable frame="all">
<tgroup cols="2">
<thead>
<row><entry>Nom codec</entry><entry>Description</entry></row>
</thead>
<tbody>
<row><entry>mjpeg</entry><entry>
   Motion JPEG
  </entry></row>
<row><entry>ljpeg</entry><entry>
   Lossless JPEG (sans perte)
  </entry></row>
<row><entry>h263</entry><entry>
  H263
  </entry></row>
<row><entry>h263p</entry><entry>
  H263 Plus
  </entry></row>
<row><entry>mpeg4</entry><entry>
  standard MPEG-4 ISO (compatible DivX 5, XVID)
  </entry></row>
<row><entry>msmpeg4</entry><entry>
  variante pré-standard MPEG-4 de MS, v3 (alias DivX3)
  </entry></row>
<row><entry>msmpeg4v2</entry><entry>
  pré-standard MPEG-4 par MS, v2 (utilisé dans les anciens fichiers asf)
  </entry></row>
  <row><entry>wmv1</entry><entry>
  Windows Media Video, version 1 (alias WMV7)
  </entry></row>
<row><entry>wmv2</entry><entry>
  Windows Media Video, version 2 (alias WMV8)
  </entry></row>
<row><entry>rv10</entry><entry>
  un vieux codec RealVideo
  </entry></row>
<row><entry>mpeg1video</entry><entry>
  video MPEG1
  </entry></row>
<row><entry>mpeg2video</entry><entry>
  video MPEG2
  </entry></row>
<row><entry>huffyuv</entry><entry>
  compression sans perte
  </entry></row>
<row><entry>asv1</entry><entry>
  ASUS Video v1
  </entry></row>
<row><entry>asv2</entry><entry>
  ASUS Video v2
  </entry></row>
<row><entry>ffv1</entry><entry>
  codec vidéo sans perte de FFmpeg
  </entry></row>
</tbody>
</tgroup>
</informaltable>

La première colonne contient le nom du codec qui devrait être passé après la config
<literal>vcodec</literal>, comme: <option>-lavcopts vcodec=msmpeg4</option>
</para>

<informalexample>
<para>
Un exemple, avec compression MJPEG:
<screen>mencoder dvd://2 -o <replaceable>titre2.avi</replaceable> -ovc lavc -lavcopts vcodec=mjpeg -oac copy</screen>
</para>
</informalexample>
</sect1>


<sect1 id="menc-feat-enc-images">
<title>Encodage à partir de multiples fichiers image (JPEGs, PNGs ou TGAs)</title>

<para>
<application>MEncoder</application> est capable de créer des fichiers à partir de un
ou plusieurs fichiers JPEG, PNG ou TGA. Avec une simple copie de trame il peut créer
des fichiers MJPEG (Motion JPEG), MPNG (Motion PNG) ou MTGA (Motion TGA).
</para>

<orderedlist>
<title>Explication du processus:</title>
<listitem><para>
  <application>MEncoder</application> <emphasis>décode</emphasis> le(s) image(s)
  d'origine avec <systemitem class="library">libjpeg</systemitem> (pour décoder
  des PNGs, il utilisera <systemitem class="library">libpng</systemitem>).
  </para></listitem>
<listitem><para>
  <application>MEncoder</application> envoie alors l'image décodée au compresseur
  vidéo choisi (DivX4, XviD, ffmpeg msmpeg4, etc.).
  </para></listitem>
</orderedlist>

<formalpara>
<title>Exemples</title>
<para>
Une explication de l'option <option>-mf</option> peut être trouvée dans la page de man.

<informalexample>
<para>
Créer un fichier DivX4 à partir de tous les fichiers JPEG du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25 -ovc divx4 -o <replaceable>sortie.avi</replaceable> \*.jpg<!--
--></screen>
</para>
</informalexample>

<informalexample>
<para>
Créer un fichier DivX4 à partir de quelques fichiers JPEG du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25 -ovc divx4 -o <replaceable>sortie.avi</replaceable> trame001.jpg,trame002.jpg <!--
--></screen>
</para>
</informalexample>

<informalexample>
<para>
Créer un fichier Motion JPEG (MJPEG) à partir de tous les fichiers JPEG du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25 -ovc copy -o <replaceable>sortie.avi</replaceable> \*.jpg<!--
--></screen>
</para>
</informalexample>

<informalexample>
<para>
Créer un fichier non-compressé à partir de tous les fichiers PNG du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25:type=png -ovc raw -o <replaceable>sortie.avi</replaceable> \*.png<!--
--></screen>
</para>
</informalexample>

<note><para>
La largeur doit être un entier multiple de 4, c'est une limitation du format AVI RGB brut.
</para></note>

<informalexample>
<para>
Créer un fichier Motion PNG (MPNG) à partir de tous les fichiers PNG du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25:type=png -ovc copy -o <replaceable>sortie.avi</replaceable> \*.png<!--
--></screen>
</para>
</informalexample>

<informalexample>
<para>
Créer un fichier Motion TGA (MTGA) à partir de tous les fichiers TGA du rép courant:
<screen>
mencoder -mf on:w=800:h=600:fps=25:type=tga -ovc copy -o <replaceable>sortie.avi</replaceable> \*.tga<!--
--></screen>
</para>
</informalexample>

</para>
</formalpara>
</sect1>


<sect1 id="menc-feat-extractsub">
<title>Extraction des sous-titres DVD dans un fichier Vobsub</title>

<para>
<application>MEncoder</application> est capable d'extraire les sous-titres d'un DVD
dans des fichiers au format VobSub. Ils consistent en une paire de fichiers terminant
par <filename>.idx</filename> et <filename>.sub</filename> et sont généralement compressés
dans une seule archive <filename>.rar</filename>. <application>MPlayer</application>
peut les lire avec les options <option>-vobsub</option> et <option>-vobsubid</option>.
</para>

<para>
Vous spécifiez le nom de base (c-a-d sans extension <filename>.idx</filename> ou
<filename>.sub</filename>) des fichiers de sortie avec <option>-vobsubout</option>
et l'index pour ces sous-titres dans le fichier final avec <option>-vobsuboutindex</option>.
</para>

<para>
Si l'entrée n'est pas un DVD vous pouvez utiliser <option>-ifo</option> pour indiquer le
fichier <filename>.ifo</filename> requis pour construire le fichier <filename>.idx</filename> final.
</para>

<para>
Si l'entrée n'est pas un DVD et que vous n'avez pas de fichier <filename>.ifo</filename>
vous aurez besoin d'utiliser l'option <option>-vobsubid</option> pour lui permettre de
savoir quel id langue placer dans le fichier <filename>.idx</filename>.
</para>

<para>
Chaque étape ajoutera les sous-titres actifs dans les fichiers <filename>.idx</filename>
et <filename>.sub</filename> déjà existants. Vous devrez donc les enlever avant de commencer.
</para>

<example>
<title>Copier deux sous-titres d'un DVD pendant l'encodage 3-passes</title>
<screen>
rm <replaceable>soustitres.idx</replaceable> <replaceable>soustitres.sub</replaceable>
mencoder dvd://1 -vobsubout <replaceable>soustitres</replaceable> -vobsuboutindex 0 -sid 2 -o frameno.avi -ovc frameno
mencoder dvd://1 -oac copy -ovc divx4 -pass 1
mencoder dvd://1 -oac copy -ovc divx4 -pass 2 -vobsubout <replaceable>soustitres</replaceable> -vobsuboutindex 1 -sid 5<!--
--></screen>
</example>

<example>
<title>Copier les sous-titres français depuis un fichier MPEG</title>
<screen>
rm soustitres.idx soustitres.sub
mencoder <replaceable>film.mpg</replaceable> -ifo <replaceable>film.ifo</replaceable> -vobsubout soustitres -vobsuboutindex 0 -vobsuboutid fr -sid 1<!--
--></screen>
</example>

</sect1>

<sect1 id="aspect">
<title>Préserver l'aspect ratio</title>
<para>
Les fichiers des DVDs et des SVCDs (c-a-d MPEG1/2) contiennent une valeur d'aspect
ratio, qui décrit comment le lecteur devrait dimensionner le flux vidéo, pour que les
humains n'aient pas des "têtes d'oeuf" (ex. 480x480 + 4:3 = 640x480). De toute façon,
quand vous encodez un fichier AVI (DivX), vous devez être conscients que les entêtes
AVI ne stockent pas cette valeur. Redimensionner le film est dégouttant et coûteux en
temps, il doit y avoir une meilleur solution !
</para>

<para>Il y en a une.</para>

<para>
MPEG4 a une fonction unique: le flux vidéo peut contenir l'aspect ratio requis. Oui,
tout comme les fichiers MPEG1/2 (DVD, SVCD). Malheureusement, il n'y a
<emphasis role="bold">pas</emphasis> de lecteurs vidéo au dehors qui supportent cet
attribut. Excepté <application>MPlayer</application>.
</para>

<para>
Cette fonction ne peut être utilisé qu'avec le codec <systemitem>mpeg4</systemitem> de
<emphasis role="bold"><systemitem class="library">libavcodec</systemitem></emphasis>. Gardez à l'esprit: bien que
<application>MPlayer</application> lise correctement le fichier créé, les autres lecteurs
utiliseront un mauvais aspect ratio.
</para>

<para>
Vous devriez sérieusement couper les bandes noires au dessus et en dessous de l'image.
Voir la page de man pour l'utilisation des filtres <systemitem>cropdetect</systemitem>
et <systemitem>crop</systemitem>.
</para>

<formalpara>
<title>Utilisation</title>
<para>
<screen>mencoder <replaceable>echantillon-svcd.mpg</replaceable> -ovc lavc -lavcopts vcodec=mpeg4:autoaspect -vf
crop=714:548:0:14 -oac copy -o <replaceable>sortie.avi</replaceable></screen>
</para>
</formalpara>
</sect1>

<sect1 id="custommatrices"><title>Inter/intra matrices personnalisées</title>

<para>
Avec cette fonction de <link linkend="ffmpeg"><systemitem class="library">libavcodec</systemitem></link> vous pouvez
initialiser des matrices personnalisées inter (I-frames/trames-clé) et intra
(P-frames/trames prévues). Elle est supportée par de nombreux codecs:
<systemitem>mpeg1video</systemitem> et <systemitem>mpeg2video</systemitem>
fonctionnent.
</para>

<para>
Une utilisation typique de cette fonction est d'initialiser les matrices
recommandées par les spécifications <ulink url="http://www.kvcd.net/">KVCD</ulink>.
</para>

<para>
La <emphasis role="bold">matrice de quantisation &quot;Notch&quot; de KVCD:</emphasis>
</para>

<para>
Intra:
<screen>
 8  9 12 22 26 27 29 34
 9 10 14 26 27 29 34 37
12 14 18 27 29 34 37 38
22 26 27 31 36 37 38 40
26 27 29 36 39 38 40 48
27 29 34 37 38 40 48 58
29 34 37 38 40 48 58 69
34 37 38 40 48 58 69 79
</screen>

Inter:
<screen>
16 18 20 22 24 26 28 30
18 20 22 24 26 28 30 32
20 22 24 26 28 30 32 34
22 24 26 30 32 32 34 36
24 26 28 32 34 34 36 38
26 28 30 32 34 36 38 40
28 30 32 34 36 38 42 42
30 32 34 36 38 40 42 44
</screen>
</para>

<para>
Utilisation:
<screen>
$ mencoder <replaceable>entree.avi</replaceable> -o <replaceable>sortie.avi</replaceable> -oac copy -ovc lavc
-lavcopts inter_matrix=...:intra_matrix=...
</screen>
</para>

<para>
<screen>
$ mencoder <replaceable>entree.avi</replaceable> -ovc lavc -lavcopts
vcodec=mpeg2video:intra_matrix=8,9,12,22,26,27,29,34,9,10,14,26,27,29,34,37,
12,14,18,27,29,34,37,38,22,26,27,31,36,37,38,40,26,27,29,36,39,38,40,48,27,
29,34,37,38,40,48,58,29,34,37,38,40,48,58,69,34,37,38,40,48,58,69,79
:inter_matrix=16,18,20,22,24,26,28,30,18,20,22,24,26,28,30,32,20,22,24,26,
28,30,32,34,22,24,26,30,32,32,34,36,24,26,28,32,34,34,36,38,26,28,30,32,34,
36,38,40,28,30,32,34,36,38,42,42,30,32,34,36,38,40,42,44 -oac copy -o
<replaceable>svcd.mpg</replaceable>
</screen>
</para>
</sect1>

<sect1 id="menc-feat-dvd-mpeg4">
<title>Créer un rip MPEG4 (&quot;DivX&quot;) de haute qualité à partir d'un DVD</title>

<para>
  Ripper un titre DVD dans un fichier MPEG4 (DivX) de qualité maximale implique de
  nombreuses considérations. Vous trouverez plus bas un exemple du processus quand il
  n'y a pas de taille de fichier particulière à atteindre (à part peut être faire tenir
  le résultat dans 2 Go). <systemitem class="library">libavcodec</systemitem>
  sera utilisé pour la vidéo, et l'audio sera copié sans aucun changement.
</para>

<sect2 id="menc-feat-dvd-mpeg4-crop">
<title>Découpage</title>
<para>
  Lisez le DVD et appliquez le filtre de détection de découpage
  (<option>-vf cropdetect</option>) dessus. Cela affiche un rectangle de découpage
  à utiliser pour l'encodage. Les raisons du découpage sont que beaucoup de films ne sont
  pas dans un aspect ratio standard (16/9 ou 4/3), ou, pour n'importe quelle raison,
  l'image ne tient pas dans la trame. Vous pouvez aussi les bandes noires quand vous rippez.
  Cela améliore la qualité du rip car le bord dur des bandes noires gaspille beaucoup de
  bits. Un aspect courant est 2.35, ce qui corresponds au cinescope. La plupart des gros
  <emphasis>blockbusters</emphasis> ont cet aspect ratio.
</para>
</sect2>

<sect2 id="menc-feat-dvd-mpeg4-quality">
<title>Niveau de qualité</title>
<para>
  Ensuite vous devez choisir le niveau de qualité désiré. Quand il n'y a pas besoin
  de garder une certaine taille pour tenir sur des CDs ou autres, en utilisant une
  quantisation constante, c-a-d. une qualité constante, est un bon choix. De cette
  façon chaque trame reçoit autant de bits dont elle a besoin pour maintenir la
  qualité au niveau désiré, mais les multiples passes d'encodage ne sont pas requises.
  Avec <systemitem class="library">libavcodec</systemitem>, vous pouvez obtenir une
  qualité constante en utilisant
  <option>-lavcopts vqscale=<replaceable>N</replaceable></option>.
  <option>vqscale=3</option> devrait vous donner un fichier de taille inférieure à 2Go,
  suivant la longueur du film et le bruit de la vidéo (plus il y a de bruit, plus il est
  difficile de comresser.)
</para></sect2>

<sect2 id="menc-feat-dvd-mpeg4-2gb">
<title>Fichiers de plus de 2 Go</title>
<para>
  Si le fichier provenant d'un encodage à qualité constante fait plus de 2 Go,
  vous devrez créer un index pour pouvoir le voir correctement.
  Vous devez soit

<itemizedlist>
<listitem><para>
  lire le film avec <option>-forceidx</option> pour créer un index à la volée,
  </para></listitem>
<listitem><para>
  utiliser <option>-saveidx</option> pour écrire l'index dans un fichier une fois pour
  toute et <option>-loadidx</option> pour l'utiliser pour la lecture de ce fichier.
  </para></listitem>
</itemizedlist>

  Si cela vous ennuie, vous préférez peut-être garder la taille du fichier inférieure à 2 Go.
</para>

<para>
  Il y a trois façons d'éviter cela. Vous pouvez essayer de réencoder en utilisant
  <option>vqscale=4</option> et voir si la taille et la qualité sont toutes deux
  acceptables. Vous pouvez aussi utiliser
  <link linkend="menc-feat-divx4">l'encodage 2 passes</link>.
  Puisque vous copiez la piste audio telle quelle et que donc vous connaissez
  son débit, et que vous connaissez la durée du film, vous pouvez calculer
  le débit requis à passer à l'option
  <option>-lavcopts vbitrate=<replaceable>bitrate</replaceable></option>
  en utilisant <link linkend="menc-feat-divx4">l'encodage 3 passes</link>.
</para>

<para>
  La troisième et peut-être la meilleure option serait de légèrement diminuer
  la résolution. Le 'softening' léger et la perte de détails est visuellement
  préférable à la pixélisation et autres artéfacts de la compression MPEG.
  Diminuer la résolution réduit le bruit de l'image, ce qui est bénéfique, car
  le bruit est difficile à compresser.
</para></sect2>

<sect2 id="menc-feat-dvd-mpeg4-deinterlacing">
<title>Désentrelacement</title>
<para>
  Si le film est entrelaçé, vous pouvez le désentrelaçer pendant le rip.
  Le faire à cette étape est discutable. L'avantage est que le désentrelaçement
  pendant la conversion en MPEG4 rends la compression meilleure, et le visionnage
  plus facile et moins gourmand en CPU sur des moniteurs d'ordinateur car aucun
  désentrelacement n'est requis.
</para>

<para>
  Savoir si on désentrelace durant l'étape du rip dépends du DVD. Si le DVD est
  un film, qui a été tourné en 24 fps, vous pouvez très bien désentrelacer pendant
  le rip. Si, par contre, la vidéo originale est en 50/60 fps, la convertir en
  vidéo 23.976/25 fps désentrelaçé perdra des informations. Si vous décidez tout de même de désentrelacer, vous pouvez essayer avec différents filtres de désentrelacement, voir
  <ulink url="http://www.wieser-web.de/MPlayer/">http://www.wieser-web.de/MPlayer/</ulink>
  pour des exemples. Un bon point de départ est <option>-vf pp=fd</option>.
</para>

<para>
  Si vous découpez et désentrelacez en même temps, désentrelacez
  <emphasis>avant</emphasis> de découper. En fait, cela n'est pas nécessaire
  si l'offset de découpage vertical est un multiple de 2 pixels. De toute façon
  avec certains autres filtres comme le dering vous devez toujours découper en dernier,
  donc c'est une bonne habitude à prendre de mettre le filtre de découpage en dernier.
</para></sect2>

<sect2 id="menc-feat-dvd-mpeg4-telecine">
<title>Telecine inversé</title>
<para>
  Si vous rippez un DVD PAL, qui est en 25 fps, vous n'avez pas à vous soucier
  des fps. Utilisez juste 25 fps. D'un autre coté les DVDs NTSC sont en
  29.97 fps (souvent arrondi à 30 fps, mais ce n'est pas la vitesse réelle).
  Si le film à été enregistré pour la TV, vous n'avez encore une fois pas à
  toucher les fps. Mais si le film a été enregistré sur pellicule, et donc à
  (exactement) 24 fps, il a été converti en 29.97 fps pour le presser sur DVD.
  La conversion où 12 champs sont ajoutés toutes les 24 trames est appelée telecine.
  Pour plus d'infos sur telecine, faites
  <ulink url="http://www.google.com/search?q=telecine+field+23.976">
  une recherche Google sur &quot;telecine field 23.976&quot;</ulink>.
</para>

<para>
  Au cas où vous ayez un DVD teleciné, vous pouvez inverser le telecine, c-a-d.
  convertir le film en 23.976 fps (29.97*4/5).
  Sinon les panoramiques seront sales et horribles. Vous pouvez utiliser
  <option>-ofps 23.976</option> pour cela. Tous ce qui est montré au cinéma
  est enregistré sur pellicule et nécessite le telecine inverse, les programmes TV
  n'en ont pas besoin.
</para></sect2>

<sect2 id="menc-feat-dvd-mpeg4-scaling">
<title>Redimensionnement et aspect ratio</title>
<para>
  Pour une meilleur qualité, ne redimensionnez pas les films pendant le rip.
  Le redimensionnement produit des artéfacts et un fichier plus gros. Les
  pixels des films DVD ne sont pas carrés, donc ces films incluent des infos
  sur l'aspect ratio correct. Il est possible d'insérer l'aspect ratio dans
  l'entête MPEG4 du fichier de sortie. La plupart des lecteurs vidéos ignorent
  cette info, mais <application>MPlayer</application> l'utilise. Donc si vous
  comptez utiliser uniquement <application>MPlayer</application> pour lire le fichier
  rippé, vous n'avez pas besoin de redimensionner le film, passez juste
  <option>-lavcopts autoaspect</option> à <application>MEncoder</application>
  et tout sera fait automatiquement.
  Si vous devez redimensionner le film, assurez-vous de garder une taille correcte,
  surtout si vous découpez.
</para>
</sect2>

<sect2 id="menc-feat-dvd-mpeg4-summary">
<title>Résumons</title>
<para>
  Avec tout ce qui a été mentioné plus haut, une commande d'encodage convenable pourrait
  être

  <screen>
mencoder dvd://1 -aid 128 -oac copy -ovc lavc -lavcopts vcodec=mpeg4:vqscale=3:vhq:v4mv:trell:autoaspect \
  -ofps 23.976 -vf crop=720:364:0:56 -o Harry_Potter_2.avi
  </screen>

  Ici <option>dvd://1</option> indique le titre DVD à ripper. l'option
  <option>-aid 128</option> dit d'utiliser la piste audio 128, et
  <option>-oac copy</option> de la copier telle quelle. Vous devrez utiliser
  <application>MPlayer</application> pour trouver les bonnes valeurs pour ces options.
</para>

<para>
  Les options <option>vhq:v4mv:trell</option> pour
  <option>-lavcopts</option> améliorent la qualité vis-à-vis du débit, mais rends l'encodage
  plus long. Surtout <option>trell</option> qui ralentit l'encodage mais augmente visiblement
  la qualité. Si vous voulez désentrelacer, ajoutez un filtre <option>pp</option> à
  <option>-vf</option>, par exemple
  <option>-vf pp=fd,crop=720:364:0:56</option> (dans cet ordre). Si vous n'avez pas besoin
  de telecine inverse, enlevez <option>-ofps 23.976</option>.
</para>
</sect2>

</sect1>


</chapter>
