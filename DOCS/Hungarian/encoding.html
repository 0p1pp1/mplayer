<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<HEAD>
  <LINK REL="stylesheet" TYPE="text/css" HREF="../default.css">
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-2">
</HEAD>

<BODY>


<P><B><A NAME=2.4>2.4.  Enkódolás a MEncoderrel</A></B></P>

<P><B><A NAME=2.4.1>2.4.1.  Bevezetõ</B></P>

<P>A <B>MEncoder</B> (<B>MPlayer</B>'s Movie Encoder) egy egyszerû film
  enkóder, az MPlayer által lejátszható formátumok
  (<B>AVI/ASF/OGG/DVD/VCD/VOB/MPG/MOV/VIV/FLI/RM/NUV/NET</B>) más - MPlayerrel
  lejátszható - formátumokba kódolására. Sokféle codec-kel tud enkódolni,
  például <B>DivX4</B>-gyel (1 vagy 2 menetes), a libavcodec-et alkotó
  codec-ekkel, audiot tekintve pedig
  <B>PCM</B>/<B>MP3</B>/<B>VBR MP3</B> a választék. Rendelkezik továbbá stream
  másoló, és video átméretezõ képességgel.</P>


<P><B><A NAME=2.4.2>2.4.2.  Fordítás</B></P>

<P>
  <UL>
    <LI>olvasd el az <B>MPlayer</B> fordítási útmutatóját.</LI>
    <LI><B>OPCIONÁLIS (CSAK LINUX)</B> - töltsd le a legújabb <B>DivX4linux</B> könyvtárat például
      <A HREF="http://avifile.sourceforge.net/download.htm">innen</A>, és
      installáld HELYESEN. Ez szükséges a DivX4 (1/2 menetes) enkódoláshoz.</LI>
    <LI><B>OPCIONÁLIS</B> - <A HREF="codecs.html#2.2.1.9">töltsd le és
      installáld az <B>XViD</B>-et</A>. Nem túl hasznos, a libavcodec
      <I>mpeg4</I> codec-e sokkal gyorsabban és jobb minõségben kódol.</LI>
    <LI><B>OPCIONÁLIS</B> - ha a libavcodec codec-ekkel is akarsz enkódolni,
      installáld a libavcodec-et, ahogyan az a <A HREF="codecs.html#2.2.1.2">libavcodec
      fejezetben</A> le van írva.</LI>
    <LI><B>OPCIONÁLIS</B> - töltsd és fordítsd le a <B>libmp3lame-t</B> (a lame 3.89bétából vagy
      CVS-bõl).<BR>
      <B>A lame 3.90 elõtti verzióit NE GCC 2.96-TAL FORDÍTSD! Nem fognak
      helyesen mûködni!</B><BR>
      Ez szükségeltetik a CBR/VBR MP3 audio enkódoláshoz. Egy
      egyszerû <CODE>lame</CODE> bináris nem elég. Mégvalami: minél kevesebb
      optimalizációt használsz a lame fordításánál, annál jobb lesz a minõsége.
      A minõséget a fordítás utáni <CODE>make test</CODE> paranccsal
      ellenõrizheted. A kiírt számnak <B>30</B>-nál kevesebbnek kell lennie.
      Azért ne ess pánikba ha pl <B>400</B> fölötti értéket kapsz, nem
      valószínû hogy hallod a különbséget. Jaigen, ha a fordítód nem tudja
      a tesztet lefuttatni.. Nos, töröld már le azt a nyavajás <B>GCC 2.96</B>-ot.</LI>
    <LI><B>OPCIONÁLIS</B> - <CODE>libjpeg</CODE> és <CODE>libpng</CODE> -
      lásd az <A HREF="documentation.html#1.3">Installálás</A> 
      fejezetet</LI>
  </UL>
</P>

<P>Kész. Mint minden bizonnyal tudod, más enkódolóknak szükségük van az
  <I>avifile</I> könyvtárra. A <B>MEncoder</B>-nek egyáltalán nincs.</P>

<P><B><A NAME=2.4.3>2.4.3.  MEncoder funkciók</B></P>

<P>
  <UL>
    <LI>enkódolás az összes file formátumból amit az <B>MPlayer</B> lejátszani
      képes</LI>
    <LI>az ffmpeg/libavcodec által támogatott összes codec használata kódolásra
      is</LI>
    <LI>enkódolás <B>V4L kompatibilis TV tunerekrõl</B></LI>
    <LI>enkódolása/multiplexelése interleaved AVI-knak, megfelelõ index-szel</LI>
    <LI>opcionálisan külsõ audio stream használata</LI>
    <LI>1, 2 vagy 3 menetes enkódolás</LI>
    <LI><B>VBR</B> MP3 audio - <B>FONTOS</B> : a VBR-es mp3-ak nem minden
      körülmények között lejátszhatóak windows rendszereken! Viszont a
      <B>MEncoderrel</B> által létrehozott CBR AVI-k teljesen lejátszhatatlanok
      Win32 lejátszókkal :)</LI>
    <LI>PCM audio</LI>
    <LI>stream másolás</LI>
    <LI>bemeneti file A/V szinkronizálása (PTS-alapú, az -mc 0 opcióval
      kikapcsolható)</LI>
    <LI>FPS javítás az <CODE>-ofps</CODE> opcióval (hasznos ha 29.97fps-es
      VOB-ot kódolsz 24fps-es AVI-ba)</LI>
    <LI>a video filter réteg használata (crop, expand, flip, postprocess,
      rotate, scale, RGB/YUV konverzió)</LI>
    <LI>a kimeneti file-ba bele tudja kódolni mind a DVD/VOBsub, mind a
      szöveges feliratokat</LI>
    <LI>DVD feliratok külsõ VOBsub file-ba történõ rippelése</LI>
  </UL>
</P>

<P><B><I>Tervezett funkciók</I></B> :
  <UL>
    <LI>még szélesebb skálája a be/kimeneti formátumoknak, codec-eknek
      (VOB file-ok DivX4/Indeo5/VIVO videoval... :)</LI>
    <LI>audio enkódolása v4l-rõl (BSD-n már kész?)</LI>
  </UL>
</P>

<P><B><A NAME=2.4.3.1>2.4.3.1.  2, 3 menetes DivX4 enkódolása</B></P>

<P><U><B>2 menetes enkódolás :</B></U> az elnevezés onnan jön, hogy ezzel a
  módszerrel a file <I>kétszer</I> lesz enkódolva. Az elsõ menet néhány pár
  Mb-os ideiglenes (*.log) file-t hoz létre, amiket egyelõre nem szabad törölni
  (az AVI törölhetõ, ugyanolyan mintha -pass opciók nélkül keletkezett volna).
  A második menetben keletkezik a tényleges 2 menetes DivX, az ideiglenes
  file-ok adataibõl. A keletkezõ file az egy menetesekhez képest sokkal jobb
  minõséggel és kisebb mérettel bír. Ha most hallassz errõl elõször, jobb ha
  keresel a neten egy útmutatót.</P>

<P>A következõ példa egy DVD 2 menetes DivX4 AVI-ba történõ enkódolását
  mutatja be. Csak két parancs szükséges :<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;rm frameno.avi</CODE> - töröld ezt a file-t,
    ami egy esetleges elõzõ 3 menetes enkódolásból származhat<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -divx4opts br=1100
    -o movie.avi -pass 1<BR>
  &nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -divx4opts br=1100 
    -o movie.avi -pass 2</CODE></P>

<P><U><B>3 menetes enkódolás :</B></U> ez egyfajta bõvített kétmenetes
  enkódolás. A különbség abban áll hogy itt az audio enkódolása külön
  menetben történik, ezáltal lehetõvé válik annak megbecslése hogy az adott
  filmet milyen bitrátával kell tömöríteni hogy ráférjen egy 650, 700 vagy
  800Mb-os CD-re, és ezt a <B>MEncoder</B> ki is számolja. Továbbá, ilyenkor
  az audio csak egyszer kerül enkódolásra, ellentétben a 2 menetes móddal.
  A használata a következõ :</P>

<TABLE>
  <TR>   
  <TD>      <CODE>rm frameno.avi</CODE></TD>
    <TD>      <B>egy esetleges elõzõ 3 menetes enkódolásból származó file törlése,
      mely konfliktolhat a most következõvel</B></TD>
  </TR>
  <TR> 
    <TD>      <CODE>mencoder &lt;file/DVD&gt; -ovc frameno -o
        frameno.avi</CODE></TD>
    <TD>      <B><U>Elsõ menet</U> : egy csak audiot tartalmazó AVI file jön létre,
      ami a kért formátumban tartalmazza az audio streamet. Ha akarod
      használhatod a <CODE>-lameopts</CODE> opciót. Ha ez egy hosszabb film,
      e menet végén a MEncoder kiírja hogy mekkora bitrate-tel tömöríts
      a következõ menetekben hogy a film ráférjen egy 650, 700 vagy 800Mb-os
      CD-re.</B></TD>
  </TR>
  <TR> 
    <TD>      <CODE>mencoder &lt;file/DVD&gt; -oac copy -pass 1
        -divx4opts br=&lt;bitrate&gt;</CODE></TD>
    <TD>      <B><U>Második menet</U> : alias a DivX4 video enkódolás elsõ menete.
      Opcionálisan megadhatod azt a bitrate-et amit a MEncoder az elõzõ
      menet végén kiírt, lásd feljebb.</B></TD>
  </TR>
  <TR> 
    <TD>      <CODE>mencoder &lt;file/DVD&gt; -oac copy -pass 2
        -divx4opts br=&lt;bitrate&gt;</CODE></TD>
    <TD>      <B><U>Harmadik menet</U> : alias a DivX4 video enkódolás második menete.
      Opcionálisan megadhatod azt a bitrate-et amit a MEncoder az elõzõ
      menet végén kiírt, lásd feljebb. Ebben a menetben a
      <CODE>frameno.avi</CODE>-ban levõ audio belekerül a célfileba..
      és kész is az egész!</B></TD>
  </TR>
</TABLE>

<P><B>Példa a 3 menetes enkódolásra :</B></P>

<P><CODE>&nbsp;&nbsp;&nbsp;&nbsp;rm frameno.avi</CODE> - esetlegesen egy elõzõ
  enkódolásbol származó file törlése (bezavar a most következõnek)<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc frameno
    -o frameno.avi<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2
    -divx4opts br=1100 -oac copy -o movie.avi -pass 1<BR>
  &nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -divx4opts
    br=1100 -oac copy -o movie.avi -pass 2</CODE>
</P>

<P><U><B>2, vagy 3 menetes enkódolás a libavcodec 2 menetes kódjával:</B></U>
  Használata esetén elképzelhetõ, hogy az átlagos bitráta jobban fog
  közelíteni a megadotthoz, mint a DivX4-es módszer esetén.</P>

<UL>
  <LI><B>2 menetes enkódolás:</B><BR>
    <CODE>rm -f lavc_stats.txt<BR>
    mencoder -dvd 2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 (audio-opciók) -o
      movie.avi<BR>
    mencoder -dvd 2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=2 (audio-opciók) -o
      movie.avi</CODE></LI>
  <LI><B>3 menetes enkódolás:</B><BR>
    <CODE>rm -f frameno.avi lavc_stats.txt<BR>
    mencoder -dvd 2 -ovc frameno (audio-opciók) -o frameno.avi<BR>
    mencoder -dvd 2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=1 -oac copy -o
      movie.avi<BR>
    mencoder -dvd 2 -ovc lavc -lavcopts vcodec=mpeg4:vpass=2 -oac copy -o
      movie.avi</CODE></LI>
</UL>


<P><B><A NAME=2.4.3.2>2.4.3.2.  Átméretezés</B></P>

<P>Gyakran elõjön a filmek átméretezésének igénye. Ennek oka sokféle lehet,
  például a fileméret csökkentése, vagy SVCD-bõl DivX-be kódolás. A rippelt
  DVD-ket legtöbbször átméretezik (például egy 4:3-as DVD-t 640x480-ra),
  különösen akkor ha a cél az 1 CD-s méret és ezzel együtt a jó minõség is.
  Az SVCD-k képmérete 480x480, és a lejátszóprogramok az ezen fileok
  fejlécében található aspektusinformáció alapján számítják ki a megjelenítendõ
  kép méretét (pl.: 480x480 + 4:3 = 640x480). Ezért AVI (DivX) file-okba
  történõ kódolásnál figyelembe kell venni azt is, hogy az AVI file-ok ezen
  információ eltárolására nem képesek. Így az egyetlen megoldás az átméretezés.</P>

<P>Az átméretezést a <I>'scale'</I> nevû video filter végzi:
  <CODE>-vop scale=X:Y</CODE>. A minõségét pedig az <CODE>-sws</CODE> opcióval
  lehet megadni (lásd a manpage-t). Alapértelmezett a 0 : gyors bilinear.</P>

<P>Használata :<BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder sample-svcd.mpg -divx4opts br=1300 -vop scale=640:480 -sws 2 -o output.avi</CODE></P

<P><B><A NAME=2.4.3.3>2.4.3.3.  Stream másolása</B></P>

<P>A <B>MEncoder</B> kétféleképpen tudja a bemeneti stream-eket kezelni :
  <B>enkódolja</B> vagy csak <B>átmásolja</B> õket. Ez a rész a <B>másolásról</B>
  szól.</P>

<UL>
  <LI><B>Video stream-ek</B> (<CODE>-ovc copy</CODE> opció): érdekes dolgokat
    lehet vele csinálni :)<BR>
    Mint például FLI vagy VIVO vagy MPEG1 video másolása AVI file-ba!
    Persze az ilyen videokat csak az <B>MPlayer</B> tudja lejátszani :) És
    ezeknek a haszna gyakorlatilag nulla. A racionális felhasználása ennek
    például amikor csak az audio stream-et kell enkódolni (pl tömörítetlen
    PCM-et MP3-ba).</LI>

  <LI><B>Audio stream-ek</B> (<CODE>-oac copy</CODE> opció): egyértelmû.
    Lehetséges az audio streamet egy külsõ fileból (MP3, AC3, Vorbis) is venni,
    ehhez az <CODE>-audiofile &lt;filenév&gt;</CODE> opciót kell
    használni.</LI>
</UL>

<P><B><A NAME=2.4.3.4>2.4.3.4.  Hibás index-szel rendelkezõ AVI-k rendbehozása</B></P>

<P>A legkönnyebb dolog a világon. Egyszerûen átmásoljuk a video és audio
  streameket, és közben a <B>MEncoder</B> létrehozza a megfelelõ indexet is.
  Ez persze nem tudja kijavítani az esetleges hibákat a video és/vagy audio
  stream-ekben, viszont a hibásan interleave-elt fileokat igen.</P>

<P>A parancs: <CODE>mencoder -idx input.avi -ovc copy -oac copy -o output.avi</CODE></P>


<P><B><A NAME=2.4.3.5>2.4.3.5.  Enkódolás a <I>libavcodec</I> codec-ekkel</B></P>

<P>A <A HREF="codecs.html#2.2.1.2">libavcodec</A>-kel egyszerûen lehet kódolni
  jónéhány érdekes video és audio formátumba (jelenleg az audio codec-ek nem
  támogatottak). A következõ codec-ekkel lehet enkódolni :</P>

<UL>
  <LI>mjpeg - Motion JPEG</LI>
  <LI>h263 - H263</LI>
  <LI>h263p - H263 Plus</LI>
  <LI>mpeg4 - DivX4</LI>
  <LI>msmpeg4 - a régi DivX</LI>
  <LI>msmpeg4v2 - Micro$oft MPEG4 v2 (a DivX alias MP43 elõdje)</LI>
  <LI>rv10 - egy régi RealVideo codec</LI>
  <LI>mpeg1video - MPEG1 video :)</LI>
</UL>

<P>Az elsõ oszlopban felsorolt codec-eket kell átadni a
  <CODE>vcodec</CODE> opciónak, pl : <CODE>-lavcopts vcodec=msmpeg4</CODE></P>

<P>Egy példa, MJPEG tömörítéssel:<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -o title2.avi -ovc lavc
    -lavcopts vcodec=mjpeg</CODE></P>


<P><B><A NAME=2.4.3.6>2.4.3.6.  Enkódolás több bemeneti file-ból (JPEG, PNG)</B></P>

<P>A <B>MEncoder</B> képes több JPEG vagy PNG file-ból filmet létrehozni.
  Egyszerû framecopy használatával pedig MJPEG (Motion JPEG) vagy MPNG
  (Motion PNG) filmek hozhatók létre.</P>

<P><B><I>A folyamat magyarázata</I></B></P>

<P>Elõször a <B>MEncoder</B> <I>dekódolja</I> a bemeneti fileokat a
  <CODE>libjpeg</CODE> segítségével (PNG-k dekódolását a libpngvel végzi).
</P>

<P>A <B>MEncoder</B> ezután a kiválasztott kimeneti codecnek adja a
  dekódolt képet (pl DivX4, Xvid, ffmpeg msmpeg4, stb). Vigyázat: a PNG
  dekóder jelenleg csak RGB formátumú képek kiadására képes, így nem
  használható olyan codecekkel amelyek YUV formátumot várnak. Ilyen
  például a DivX4, vagy az ffmpeg-beli msmpeg4.</P>

<P><B><I>Példák</I></B></P>

<P>Az <CODE>-mf</CODE> opció magyarázata a lenti összefoglaló
  <A HREF=#2.4.5>Opciók</A> fejezetben, illetve a manpage-ben található.</P>

<P><I>DivX4 film létrehozása az aktuális könyvtárban található összes JPEG fileból :</I><BR>
  &nbsp;&nbsp;<CODE>mencoder \*.jpg -mf on:w=800:h=600:fps=25 -ovc divx4 -o
  kimenet.avi</CODE></P>

<P><I>DivX4 film létrehozása néhány JPEG fileból :</I><BR>
  &nbsp;&nbsp;<CODE>mencoder frame001.jpg,frame002.jpg -mf on:w=800:h=600:fps=25 -ovc divx4 -o
  kimenet.avi</CODE></P>

<P><I>MJPEG (Motion JPEG) film létrehozása az aktuális könyvtárban található összes JPEG fileból :</I><BR>
  &nbsp;&nbsp;<CODE>mencoder \*.jpg -mf on:w=800:h=600:fps=25 -ovc copy
  -o kimenet.avi</CODE></P>

<P><I>Tömörítetlen film létrehozása az aktuális könyvtárban található összes PNG fileból :</I><BR>
  &nbsp;&nbsp;<CODE>mencoder \*.png -mf on:w=800:h=600:fps=25:type=png -ovc raw -o
  kimenet.avi</CODE></P>

<P><I>MPNG (Motion PNG) film létrehozása az aktuális könyvtárban található összes PNG fileból :</I><BR>
  &nbsp;&nbsp;<CODE>mencoder \*.png -mf on:w=800:h=600:fps=25:type=png -ovc copy
  -o kimenet.avi</CODE></P>


<P><B><A NAME=2.4.3.7>2.4.3.7  DVD feliratok VOBsub formátumúvá alakítása

<P><B>A <B>MEncoder</B> képes DVD-rõl kivonni a feliratot, és átalakítani
  Vobsub formátumú felirattá. Ezek egy <CODE>.idx</CODE> és egy
  <CODE>.sub</CODE> kiterjesztésû file-ból állnak, gyakran egyetlen
  <CODE>.rar</CODE> archívba tömörítve. Az <B>MPlayer</B> képes az ilyen
  feliratok megjelenítésére a <CODE>-vobsub</CODE> és <CODE>-vobsubid</CODE>
  opciókkal.</P>

<P>Az alap filenevet (tehát kiterjesztés nélkül) a <CODE>-vobsubout</CODE>
  opcióval adhatod meg. Az index számot amin el lesz tárolva a felirat,
  pedig a <CODE>-vobsuboutindex</CODE> opcióval.</P>

<P>Ha a bemeneti file nem DVD, használd az <CODE>-ifo</CODE> opciót, amivel
  megadhatod hogy melyik file legyen <CODE>.idx</CODE>-é alakítva.</P>

<P>Ha a bemeneti file nem DVD, de nincs meg hozzá az <CODE>.ifo</CODE> file,
  használd a <CODE>-vobsubid</CODE> opciót a használandó nyelv azonosítójának
  kiválasztásához.</P>

<P>Minden egyes futás hozzáfûzi a kimenetet az esetlegesen már létezõ
  kimeneti file-hoz, így ajánlott körülnézni indítás elõtt.</P>

<P><B>Példák</B></P>

<P><I>Két felirat másolása DVD-rõl, 3 menetes enkódolás közben</I><BR>
  &nbsp;&nbsp;<CODE>rm subtitles.idx subtitles.sub</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -vobsubout subtitles -vobsuboutindex 0
    -sid 2 -o frameno.avi -ovc frameno</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -oac copy -ovc divx4 -pass 1</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -oac copy -ovc divx4 -pass 2 -vobsubout
    subtitles -vobsuboutindex 1 -sid 5</CODE></P>

<P><I>Francia nyelvû felirat másolása MPEG-bõl</I><BR>
  &nbsp;&nbsp;<CODE>rm subtitles.idx subtitles.sub</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder movie.mpg -ifo movie.ifo -vobsubout subtitles
    -vobsuboutindex 0 -vobsuboutid fr -sid 1</CODE></P>

<P><B><A NAME="2.4.4">2.4.4 Opciók</A></B></P>

<P>A rendelkezésre álló összes opció listája példákkal együtt a manpage-ben
  található.</P>

</BODY>
</HTML>
