<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<HEAD>
  <TITLE>Kodowanie - MEncoder - Koder filmów dla Linuksa</TITLE>
  <LINK REL="stylesheet" TYPE="text/css" HREF="default.css">
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-2">
</HEAD>

<BODY>


<H1><A NAME="encoding">7. Kodowanie z MEncoderem</A></H1>

<P>Po kompletn± listê dostêpnych opcji i przyk³adów MEncoder, proszê zobaczyæ
  stronê manuala. Po serie rêcznych przyk³adów i detali u¿ywania ró¿nych 
  parametrów kodowania, czytaj
  <A HREF="tech/encoding-tips.txt">sztuczki-kodowania</A> gdzie zgromadzone s±
  ro¿ne w±tki mailowe
  <A HREF="http://mplayerhq.hu/mailman/listinfo/mplayer-users">mplayer-users</A>.
  Szukaj w <A HREF="http://mplayerhq.hu/pipermail/mplayer-users/">archiwach</A>
  zbiorach dyskusyjnych o wszystkich aspektach problemów dotycz±cych kodowania
  MEncoderem.</P>


<H2><A NAME="2pass">7.1 Kodowanie 2 lub 3-krokowe MPEG-4 ("DivX")</A></H2>

<P><U><B>Kodowanie 2-krokowe:</B></U> jak sama nazwa wskazuje, metoda ta koduje
  plik <I>dwukrotnie</I>. Krok pierwszy (<I>krok zdybinguj±cy</I>)
  tworzy pliki podrêczne (*.log) z rozmiarem kilku megabajtów, nie kasuje ich
  jeszcze (mo¿esz usun±æ AVI). W drugim kroku, plik 2-kroku (sic!) jest tworzony
  u¿ywaj±c bitreatu danych z pliku podrêcznego. Plik wynikowy bêdzie mia³ lepsz±
  jako¶æ obrazu. Je¶li spotka³e¶ siê z tym po raz pierwszy powiniene¶ zasiêgn±æ 
  rad dostêpnych w Internecie.

<P>Przyk³ady te pokazuj± jak kodowaæ DVD do 2-krokowego MPEG-4 ("DIVX") AVI. Tylko
  dwie komendy s± potrzebne:<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;rm frameno.avi</CODE> - usuñ plik, który mo¿e
    pochodziæ z poprzedniego 3-krokowego kodowania (mo¿e kolidowaæ z obecnym)<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc lavc -lavcopts
    vcodec=mpeg4:vpass=1 -oac copy -o movie.avi<BR>
  &nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc lavc -lavcopts
    vcodec=mpeg4:vpass=2 -oac copy -o movie.avi</CODE></P>

<P><U><B>Kodowanie 3-krokowe:</B></U> to przed³u¿enie 2-krokowego kodowania,
  gdzie kodowanie audio zajmuje miejsce w osobnym kroku. Tam metoda w³±cza
  ocenê sugerowania bitreatu wideo dla dopasowania do CD. Tak¿e audio kodowane
  jest tylko tak, nie tak jak w trybie 2-krokowym. Schematy:</P>

<OL>
  <LI>Usuñ konfliktowy plik podrêczny:
    <P><CODE>rm frameno.avi</CODE></P></LI>
  <LI>Pierwszy krok:
    <P><CODE>mencoder &lt;file/DVD&gt; -ovc frameno -oac mp3lame -lameopts vbr=3 -o frameno.avi</CODE></P>
    <P>Zostanie utworzony plik avi zawieraj±cy tylko audio, <B>tylko</B> z po¿±danym strumieniem audio.
      Nie zapomnij o <CODE>-lameopts</CODE>, je¶li chcesz je ustawiæ.
      je¶li kodowa³e¶ d³ugi film, MEncoder wy¶wietla sugerowane warto¶ci bitrate dla 650Mb,
      700Mb, i 800Mb rozmiarów docelowych po ukoñczeniu kroku pierwszego.</P></LI>
  <LI>Drugi krok:
    <P><CODE>mencoder &lt;file/DVD&gt; -oac copy
      -ovc lavc -lavcopts vcodec=mpeg4:vpass=1:vbitrate=&lt;bitrate&gt;</CODE></P>
    <P>To pierwszy krok kodowania wideo.
      Opcjonalnie okre¶lony bitreate wideo MEncoder wy¶wietli³ na koñcu poprzedniego 
      kroku.</P></LI>
  <LI>Trzeci krok:
    <P><CODE>mencoder &lt;file/DVD&gt; -oac copy
      -ovc lavc -lavcopts vcodec=mpeg4:vpass=2:vbitrate=&lt;bitrate&gt;</CODE></P>
    <P>Jest to drugi krok kodwania wideo.
      Okre¶l ten sam bitreat, co w poprzednim kroku, chyba, ¿e naprawdê wiesz, co
      robisz. W tym kroku audio z <CODE>frameno.avi</CODE> zostanie
      wsuniête do docelowego pliku... i wszytko jest gotowe!</P></LI>
</OL>

<H4>Przyk³ady kodowania 3-krokowego:</H4>

<P><CODE>&nbsp;&nbsp;&nbsp;&nbsp;rm frameno.avi</CODE> - usuñ plik, który mo¿e
    pochodziæ z poprzedniego 3-krokowego kodowania (mo¿e kolidowaæ z obecnym)<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc frameno
    -o frameno.avi -oac mp3lame -lameopts vbr=3<BR>
  &nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc lavc
    -lavcopts vcodec=mpeg4:vpass=1 -oac copy -o movie.avi<BR>
  &nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -ovc lavc
    -lavcopts vcodec=mpeg4:vpass=2 -oac copy -o movie.avi</CODE></P>


<H2><A NAME="mpeg">7.2 Kodowanie do formatu MPEG</A></H2>

<P>MEncoder mo¿e stworzyæ wyj¶ciowy plik z formatem MPEG (MPEG-PS). Jes to prawdopodobnie
  u¿yteczne tylko z kodekiem libavcodeca <I>mpeg1video</I>, poniewa¿ odtwarzacze
  - poza MPlayer - poza wideo MPEG1, i MPEG1 warstwa 2 (MP2) strumieniuj± audio
  w plikach MPEG.</P>
  
<P>Cecha ta jest niezbyt u¿yteczna w tej chwili, na marginesie prawdopodobnie 
  zawiera pe³no b³êdów, ale wa¿na poniewa¿ MEncoder obecnie nie potrafi kodowaæ audio
  MPEG1 warstwy 2 (MP2), którego wszytskie inne odtwarzacze oczekuj± w plikach MPEG.</P>
  
<P>Aby zmieniæ format plików wynikowych MEncodera, u¿yj opcji <CODE>-of mpeg</CODE>.</P>

<P>Przyk³ad:<BR>
  &nbsp;&nbsp;<CODE>mencoder -of mpeg -ovc lavc -lavcopts vcodec=mpeg1video
  -oac copy &lt;other options&gt; media.avi -o output.mpg</CODE></P>


<H2><A NAME="rescaling">7.3 Skalowanie filmów</A></H2>

<P>Czêsto potrzebna jest zmiana rozmiarów obrazów filmu. Powodów mo¿e byæ wiele,
  na przyk³ad dopasowywanie rozmiarów pliku wyj¶ciowego, szeroko¶c pasma sieci, itp.
  Wiele ludzi czêsto skaluje filmy kiedy konwertuj± DVD lub SVCD do DivX AVI. <B>Jes to b³±dne.</B>
  Zamiast tego czytaj sekcjê <A HREF="#aspect">Zachowuj±c aspekt stosunku</A>.</P>

<P>Proces skalowanie nadzorowany jest przez filter wideo <I>'scale'</I>:
  <CODE>-vop scale=szeroko¶æ:wysoko¶æ</CODE>. Jego jako¶æ mo¿e zostaæ ustawiona
  przez opcjê <CODE>-sws</CODE>. Je¶li nie zostanie okre¶lona, MEncoder u¿yje 0:
  fast bilinear.</P>

<H4>U¿ycje:</H4>

<P><CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder input.mpg -ovc lavc -lavcopts
  vcodec=mpeg4 -vop scale=640:480 -oac copy -o
  output.avi</CODE></P>


<H2><A NAME="copying">7.4 Kopiowanie strumieniowe</A></H2>

<P>MEncoder potrafi przechwyciæ strumieñ wej¶ciowy na dwa sposoby: <B>koduj±c</B> lub
  <B>kopiuj±c</B> go. Ta sekcja jest o <B>kopiowaniu</B>.</P>

<UL>
  <LI><B>Strumieniowanie wideo</B> (opcja <CODE>-ovc copy</CODE>): niez³a robota 
    mo¿e zostaæ wykonana :)<BR>
    Co¶ jak wk³adanie (nie konwertowanie) wideo FLI, VIVO lub MPEG1 do
    plików AVI. Oczywi¶cie tylko MPlayer mo¿e odtwarzaæ takie pliki :)
    I prwadopodobnie nie posiada prawdziwych warto¶ci dla wszytkich. 
    Z rozs±dkiem: kopiowanie strumieni wideo mo¿e byæ u¿yteczne na przyk³ad, 
    kiedy tylko strumieñ audio by³ do kodowania (co¶ w stylu odkopmresowanego 
    pliku PCM do MP3).</LI>

  <LI><B>Strumieniowaqnie audio</B> (opcja <CODE>-oac copy</CODE>): chyba jasne.
    Mo¿liwe jest przejêcie zewnêtrznego pliku audio (MP3, Vorbis) i jego zapis
    do strumienia zewnêtrznego. U¿yj do tego opcji 
    <CODE>-audiofile &lt;filename&gt;</CODE>.</LI>
</UL>


<H2><A NAME="fixing">7.5 Naprawianie AVI z uszkodzonymi indeksami lub przeplataniem</A></H2>

<P><P>Prosto kopiujemy strumienie audio i wideo, a <B>MEncoder</B> generuje indeks.
  Oczywi¶cie nie naprawi to b³±dów strumieni wideo i/lub audio. Naprawia 
  to tak¿e pliki z uszkodzonym przeplataniem, tak wiêc opcja <CODE>-ni</CODE>
  bêdziê potrzebna tak, czy inaczej.</P>

<P>Polecenie: <CODE>mencoder -idx input.avi -ovc copy -oac copy -o output.avi</CODE></P>


<H3><A NAME="appending">7.5.1 £±czenie wielkorotnych plików AVI</A></H3>

<P>Taki efekt uboczny, finkcja naprawiaj±ca uszkodzone AVI w³±cza MPlayera do ³±czenia
  2 (lub wiêcej) plików AVI:</P>

<P>Polecenie: <CODE>cat 1.avi 2.avi | mencoder -noidx -ovc copy -oac copy -o output.avi -</CODE></P>

<P><B>Inforamcja:</B> Oczekuje to <CODE>1.avi</CODE> i <CODE>2.avi</CODE> aby u¿yc tego samego kodeka, 
  rozdzielczo¶ci, stosunku strumieniowania itp, i co najmniej 1.avi nie m¿e byæ uszkodzony.
  Mo¿e musisz najpierw naprawiæ twój wchodz±cy AVI, jak opisano <A HREF="#fixing">wy¿ej</A>.</P>

<H2><A NAME="libavcodec">7.6 Kodowanie z rodzin± kodeków libavcodec</A></H2>

<P><A HREF="codecs.html#libavcodec">libavcodec</A> zapewnia proste kodowanie do ró¿nych interesuj±cych
formatów wideo i audio (obecnie kodeki audio s± niedostêpne). Mo¿esz kodowaæ do nastêpuj±cch kodeków:</P>

<UL>
  <LI>mjpeg - Ruchome JPEG</LI>
  <LI>h263 - H263</LI>
  <LI>h263p - H263 Plus</LI>
  <LI>mpeg4 - ISO standard MPEG-4 (kompatybilne DivX 5, XVID)</LI>
  <LI>msmpeg4 - pre-standard MPEG-4 wariant MS, v3 (aka DivX3)</LI>
  <LI>msmpeg4v2 - pre-standard MPEG-4  MSu, v2 (u¿ywany w starych plikach asf)</LI>
  <LI>wmv1 - Windows Media Video, wersja 1 (aka WMV7)</LI>
  <LI>rv10 - stary kodek RealVideo</LI>
  <LI>mpeg1video - wideo MPEG1 :)</LI>
  <LI>huffyuv - bezstratna kompresja</LI>
</UL>

<P>Pierwsza kolumna zawiera nazwy kodeków, które powinny byæ podane po konfiguracji
  <CODE>vcodec</CODE>, czyli: <CODE>-lavcopts vcodec=msmpeg4</CODE></P>

<P>Przyk³ad z kompresj± MJPEG:<BR>
  <CODE>&nbsp;&nbsp;&nbsp;&nbsp;mencoder -dvd 2 -o title2.avi -ovc lavc
    -lavcopts vcodec=mjpeg -oac copy</CODE></P>


<H2><A NAME="image_files">7.7 Kodowanie z wielokrotnych plików obrazów (JPEGi, PNGsy lub TGAsy)</A></H2>

<P>MEncoder jest w stanie utworzyæ filmy z jednego lub wiêcej plików JPEG, PNG lub TGA.
  Z prostym kopiowaniem klatek potrafi utworzyæ MJPEG (Ruchome JPEG), MPNG
  (Ruchome PNG) lub MTGA (Ruchome TGA) files.</P>

Obje¶nienie procesu:

<OL>
  <LI>MEncoder <I>dekoduje</I> wej¶ciowy(e) obraz(y) z <CODE>libjpeg</CODE> 
  (kieedy dekoduje PNGsy, u¿yje <B>libpng</B>).</LI>

  <LI>MEncoder nastêpnie przekazuje dekodowane obrazy do wybranego kompresora wideo
    (DivX4, Xvid, ffmpeg msmpeg4, itp...).</LI>
</OL>

<H4>Przyk³ady</H4>

<P>Wyja¶nienie opcji <CODE>-mf</CODE>, które mo¿esz znale¶æ ni¿ej opisane 
s± w manualu.</P>

<P><I>Tworzenie pliku DivX4 ze wszytskich plików JPEG w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25 -ovc divx4
  -o output.avi \*.jpg</CODE></P>

<P><I>Tworzenie pliku DivX4 z niektórych plików JPEG w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25
  -ovc divx4 -o output.avi frame001.jpg,frame002.jpg</CODE></P>

<P><I>Tworzenie pliku Rychomego JPEG (MJPEG) ze wszystkich plików JPEG w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25 -ovc copy
  -o output.avi \*.jpg</CODE></P>

<P><I>Tworzenie pliku nieskompresowanego ze wszytskich plików PNG w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25:type=png -ovc rawrgb
  -o output.avi \*.png</CODE></P>

<P><B>Informacja:</B> Szeroko¶æ musi byæ ca³kowit± wielokrotno¶ci± 4, to limity formatu 
RAW RGB AVI.</P>

<P><I>Tworzenie Ruchomego PNG (MPNG) ze wszytskich plików w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25:type=png -ovc copy
  -o output.avi \*.png</CODE></P>

<P><I>Tworzenie Ruchomego TGA (MTGA) ze wszystkich plików TGA w obecnym katalogu:</I><BR>
  &nbsp;&nbsp;<CODE>mencoder -mf on:w=800:h=600:fps=25:type=tga -ovc copy
  -o output.avi \*.tga</CODE></P>


<H2><A NAME="vobsub">7.8 Wyci±ganie napisów DVD do pliku Vobsub</A></H2>

<P>MEncoder potrafi wyci±gn±c napisy z DVD do pliku o formacie Vobsub.
  Polegaj± one na parach kodowanych plików w 
  <CODE>.idx</CODE> i <CODE>.sub</CODE> i zazwyczaj pakowane s± w pojedyncze archiwum
  <CODE>.rar</CODE>. MPlayer potrafi je odtwarzaæ z opcjami
  <CODE>-vobsub</CODE> i <CODE>-vobsubid</CODE>.</P>

<P>Ty okre¶lasz nazwê g³ówn± (tj. bez rozszerzenia <CODE>.idx</CODE> lub
  <CODE>.sub</CODE>) pliku wyj¶ciowego z <CODE>-vobsubout</CODE>
  i indeks dla tych napisów w pliku wynikowym z <CODE>-vobsuboutindex</CODE>.</P>

<P>Je¶li plik wej¶cowy nie pochodzi z DVD powinienie¶ u¿yæ <CODE>-ifo</CODE>, aby
  wskazaæ plik <CODE>.ifo</CODE> wymagany do konstrukcji pliku wynikowego 
  <CODE>.idx</CODE>.</P>

<P>Je¶li plik wej¶ciowy nie pochodzi z DVD, a ty nie masz pliku <CODE>.ifo</CODE>
  bêdziesz musia³ u¿yæ opcji <CODE>-vobsubid</CODE>aby poinformowaæ, który id jêzyka 
  nale¿y w³o¿yæ do pliku <CODE>.idx</CODE>.</P>

<P>Ka¿de uruchomienie bêdzie dodawaæ uruchamiane napisy je¶li pliki <CODE>.idx</CODE> i
  <CODE>.sub</CODE> ju¿ istniej±. Powiniene¶ wiêc usun±æ jakie¶ przed startem.</P>

<H4>Przyk³ady:</H4>

<P><I>Kopiowanie dwóch napisów z DVD podczas kodowania 3-krokowego</I><BR>
  &nbsp;&nbsp;<CODE>rm subtitles.idx subtitles.sub</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -vobsubout subtitles -vobsuboutindex 0
    -sid 2 -o frameno.avi -ovc frameno -oac mp3lame -lameopts vbr=3</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -oac copy -ovc divx4 -divx4opts pass=1</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder -dvd 1 -oac copy -ovc divx4 -divx4opts pass=2 -vobsubout
    subtitles -vobsuboutindex 1 -sid 5</CODE></P>

<P><I>Kopiowanie francuskich napisów z pliku MPEG</I><BR>
  &nbsp;&nbsp;<CODE>rm subtitles.idx subtitles.sub</CODE><BR>
  &nbsp;&nbsp;<CODE>mencoder movie.mpg -ifo movie.ifo -vobsubout subtitles
    -vobsuboutindex 0 -vobsuboutid fr -sid 1</CODE></P>


<H2><A NAME="aspect">7.9 Zachowanie stosunku</A></H2>

<P>Pliki DVD i SVCD (tj. MPEG1/2) zawieraj± warto¶æ stosunku, która opisuje, jak
  odtwarzacze powinny skalowaæ strumieñ wideo (np.: 480x480 + 4:3 = 640x480). 
  Jednak, kiedy kodujesz do plików AVI (DivX), powiniene¶ wiedzieæ,
  ¿e nag³ówki AVI nie zapamiêtuj± takiej warto¶ci.
  W taki sposób jedynym rozwi±znaniem jest skalowanie!</P>

<P>Tu jest.</P>

<P>MPEG4 posiada niespotykan± cechê: strumieñ wideo mo¿e zawieraæ jego wymagany 
  stosunek. Tak, tylko takie pliki jak MPEG1/2 (DVD, SVCD).
  Przesadzaj±c, <U>nie</U> ma odtwarzaczy wideo które obs³uguj± t± cechê.
  Za wyj±tkiem MPlayera.</P>

<P>Cecha ta mo¿e byæ u¿yta tylko z kodekiem <CODE>mpeg4</CODE> <B>libavcodec</B>a.
  Zatrzymaj w ¶wiadomo¶ci: chocia¿ MPlayer poprawnie odtwrza stworzone pliki,
  inne odtwarzacze u¿yj± b³êdnego stosunku.</P>

<P>Powinine¶ powa¿nie ¶ci±æ czarne obramówki na oko³o i poni¿ej obrazu filmu.
  Zobacz manual odno¶nie u¿ytku filtrów <CODE>cropdetect</CODE> i
  <CODE>crop</CODE>.</P>

<H4>U¿ycie:</H4>

<P><CODE>$ mencoder sample-svcd.mpg -ovc lavc -lavcopts
  vcodec=mpeg4:aspect=16.0/9.0 -vop crop=714:548:0:14 -oac copy -o output.avi</CODE></P>

</BODY>
</HTML>
